<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>把数据源的类库从C3P0换成了Hikari，本地查询都能感觉出来有提升 | 攻城狮小武</title>
  <meta name="viewport" content="width=1430, initial-scale=1">

  <link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="攻城狮小武 &raquo; Feed" href="/feed" />
<link rel="alternate" type="application/rss+xml" title="攻城狮小武 &raquo; 评论Feed" href="/comments/feed" />
<link rel="alternate" type="application/rss+xml" title="攻城狮小武 &raquo; 把数据源的类库从C3P0换成了Hikari，本地查询都能感觉出来有提升评论Feed" href="/archives/228.html/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.tiaobug.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.12"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='dw_timeline_main-css'  href='/wp-content/themes/dw-timeline/assets/css/main.css?ver=6c39f42987ae297a5a21e2bb35bf3402' type='text/css' media='all' />
<link rel='stylesheet' id='dw_timeline_style-css'  href='/wp-content/themes/dw-timeline/style.css?ver=c1a58eb4baaf24c3771085df3d54ff8d' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/www.tiaobug.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='/wp-content/themes/dw-timeline/assets/js/vendor/modernizr-2.7.0.min.js'></script>
<script type='text/javascript' src='/wp-content/themes/dw-timeline/assets/js/vendor/nivo-lightbox.min.js'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='【职业病】  margin-right: -100px !important;' href='/archives/223.html' />
<link rel='next' title='这只小鸟很完美：推特客户端 Twidere' href='/archives/236.html' />
<meta name="generator" content="WordPress 4.8.12" />
<link rel="canonical" href="/archives/228.html" />
<link rel='shortlink' href='/?p=228' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Farchives%2F228.html" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Farchives%2F228.html&#038;format=xml" />
<link rel="shortcut icon" href="/wp-content/uploads/2017/12/WP3-副本.jpg">    <style>
    
        
    
          .banner hgroup:after {
        background: none;
      }   
    
    </style>    
    <link rel="icon" href="/wp-content/uploads/2017/12/cropped-WP3-副本-32x32.jpg" sizes="32x32" />
<link rel="icon" href="/wp-content/uploads/2017/12/cropped-WP3-副本-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="/wp-content/uploads/2017/12/cropped-WP3-副本-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.tiaobug.com/wp-content/uploads/2017/12/cropped-WP3-副本-270x270.jpg" />
		<style type="text/css" id="wp-custom-css">
			/*
您可以在此处加入您的CSS。

点击上方的帮助图标来了解更多。
*/
.wrap {
    padding-bottom: 100px;
}
.bottom-info{
    clear: both;
    position: fixed;
    bottom: 0px;
    background-color: #e5e5e5;
    z-index: 1000;
    text-align: center;
    width: 100%;
}		</style>
	  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?d68c66f0010a97131e967e4bab927275";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body class="post-template-default single single-post postid-228 single-format-standard">
    
<header class="banner no-cover" role="banner">
  <div class="header-inner">
      <nav class="nav-main" role="navigation">
        <div class="container">
                </div>
      </nav>
        </div>
</header>  <div class="wrap container" role="document">
    <div class="content row">
      <main class="main col-sm-8 col-sm-offset-2" role="main">
          <article class="post-228 post type-post status-publish format-standard hentry category-uncategorized dwtl normal">
    <header>
      <h1 class="entry-title">把数据源的类库从C3P0换成了Hikari，本地查询都能感觉出来有提升</h1>
      <div class="entry-meta">
	<span class="entry-author">
		<img alt='' src='http://2.gravatar.com/avatar/ea79cc3d71ad78055cfa388b491ac3d4?s=32&#038;d=retro&#038;r=g' srcset='http://2.gravatar.com/avatar/ea79cc3d71ad78055cfa388b491ac3d4?s=64&amp;d=retro&amp;r=g 2x' class='avatar avatar-32 photo' height='32' width='32' />		<span class="byline author vcard">
			By <a href="/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="/archives/228.html"><time class="published" datetime="2016-11-07T14:56:31+00:00">2016年11月7日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p>http://brettwooldridge.github.io/HikariCP/</p>
<h5></h5>
<p>下图可以结论无论是Connection回收还是Statement回收，Hikari要比C3P0高不止一个档次，在数据库查询成为系统瓶颈是，<span style="color: #3366ff;">这个数据源配置值得一换。</span></p>
<p><a href="/wp-content/uploads/2016/11/HikariCP-bench-2.4.0.png" rel="attachment wp-att-229"><img class="alignnone size-full wp-image-229" src="/wp-content/uploads/2016/11/HikariCP-bench-2.4.0.png" alt="hikaricp-bench-2-4-0" width="781" height="334" srcset="/wp-content/uploads/2016/11/HikariCP-bench-2.4.0.png 781w, /wp-content/uploads/2016/11/HikariCP-bench-2.4.0-300x128.png 300w, /wp-content/uploads/2016/11/HikariCP-bench-2.4.0-768x328.png 768w" sizes="(max-width: 781px) 100vw, 781px" /></a></p>
<p>&nbsp;</p>
<ul>
<li>One <em>Connection Cycle</em> is defined as single <code>DataSource.getConnection()</code>/<code>Connection.close()</code>.
<ul>
<li>In <em>Unconstrained</em> benchmark, connections &gt; threads.</li>
<li>In <em>Constrained</em> benchmark, threads &gt; connections (2:1).</li>
</ul>
</li>
<li>One <em>Statement Cycle</em> is defined as single <code>Connection.prepareStatement()</code>, <code>Statement.execute()</code>, <code>Statement.close()</code>.</li>
</ul>
<p><sup><sup>1</sup> Versions: HikariCP 2.4.0, commons-dbcp2 2.1, Tomcat 8.0.23, Vibur 3.0, c3p0 0.9.5.1, Java 8u45<br />
<sup>2</sup> Java options: -server -XX:+AggressiveOpts -XX:+UseFastAccessorMethods -Xmx512m<br />
</sup></p>
<p>Hikari并不是一味的快速创建和销毁资源，而是尽量使用稳定的资源完全无限的工作，这个思路和Spring的思路及其的类似。</p>
<p>下图可看出，Hikari引入后connection的数量稳定在80个左右，资源占用的稳定，这样就不会引起内存和CPU的抖动。</p>
<p>好的系统设计并<strong><span style="text-decoration: underline;"><span style="color: #ff0000; text-decoration: underline;">不一定是小的占用，而是稳定的占用</span></span></strong>。</p>
<hr />
<h5></h5>
<p><a href="/wp-content/uploads/2016/11/2.png" rel="attachment wp-att-230"><img class="alignnone size-full wp-image-230" src="/wp-content/uploads/2016/11/2.png" alt="2" width="779" height="204" srcset="/wp-content/uploads/2016/11/2.png 779w, /wp-content/uploads/2016/11/2-300x79.png 300w, /wp-content/uploads/2016/11/2-768x201.png 768w" sizes="(max-width: 779px) 100vw, 779px" /></a></p>
          </div>
    <footer>
          </footer>
  </article>
  
	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="/archives/228.html#respond" style="display:none;">取消回复</a></small></h3><p class="must-log-in">要发表评论，您必须先<a href="/wp-login.php?redirect_to=http%3A%2F%2F%2Farchives%2F228.html">登录</a>。</p>	</div><!-- #respond -->
	      </main>
    </div>
  </div>
  <div class="bottom-info">
<div style="font-size: 12px;text-align: center;padding:28px 0 0 0">@娱乐性质的个人Blog，技术文章居多，偶发性会有深思文，请谨慎关注，随意转发，如果可以请把出处写上
</div>
<div style="font-size: 10px;text-align: center;padding:5px 0 0 0">联系我，个人微博，Twitter，FaceBook等等各种账号，请@tiaobug，Email: i@tiaobug.com
</div>
<div style="font-size: 12px;text-align: center;padding:5px 0 12px 0 ">鲁ICP备17013530号
</div>
</div><script type='text/javascript' src='/wp-includes/js/comment-reply.min.js?ver=4.8.12'></script>
<script type='text/javascript' src='/wp-content/themes/dw-timeline/assets/js/vendor/jquery.infinitescroll.min.js?ver=4.8.12'></script>
<script type='text/javascript' src='/wp-content/themes/dw-timeline/assets/js/vendor/bootstrap-3.0.3.min.js?ver=4.8.12'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var dwtl = {"template_directory_uri":"http:\/\/www.tiaobug.com\/wp-content\/themes\/dw-timeline"};
var infinitescroll = {"page":"page","the_end":"the end"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/themes/dw-timeline/assets/js/scripts.js?ver=4.8.12'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.8.12'></script>

</body>
</html>
