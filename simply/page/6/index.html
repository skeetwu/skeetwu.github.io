<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>攻城狮小武</title>
  <meta name="viewport" content="width=1430, initial-scale=1">

  <link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="攻城狮小武 &raquo; Feed" href="http://www.tiaobug.com/feed" />
<link rel="alternate" type="application/rss+xml" title="攻城狮小武 &raquo; 评论Feed" href="http://www.tiaobug.com/comments/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.tiaobug.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.12"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='http://www.tiaobug.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-tomorrow-night-css'  href='http://www.tiaobug.com/wp-content/plugins/crayon-syntax-highlighter/themes/tomorrow-night/tomorrow-night.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://www.tiaobug.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='dw_timeline_main-css'  href='http://www.tiaobug.com/wp-content/themes/dw-timeline/assets/css/main.css?ver=6c39f42987ae297a5a21e2bb35bf3402' type='text/css' media='all' />
<link rel='stylesheet' id='dw_timeline_style-css'  href='http://www.tiaobug.com/wp-content/themes/dw-timeline/style.css?ver=c1a58eb4baaf24c3771085df3d54ff8d' type='text/css' media='all' />
<script type='text/javascript' src='http://www.tiaobug.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://www.tiaobug.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/www.tiaobug.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.tiaobug.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='http://www.tiaobug.com/wp-content/themes/dw-timeline/assets/js/vendor/modernizr-2.7.0.min.js'></script>
<script type='text/javascript' src='http://www.tiaobug.com/wp-content/themes/dw-timeline/assets/js/vendor/nivo-lightbox.min.js'></script>
<link rel='https://api.w.org/' href='http://www.tiaobug.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.tiaobug.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.tiaobug.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.12" />
<link rel="shortcut icon" href="http://www.tiaobug.com/wp-content/uploads/2017/12/WP3-副本.jpg">    <style>
    
        
    
          .banner hgroup:after {
        background: none;
      }   
    
    </style>    
    <link rel="icon" href="http://www.tiaobug.com/wp-content/uploads/2017/12/cropped-WP3-副本-32x32.jpg" sizes="32x32" />
<link rel="icon" href="http://www.tiaobug.com/wp-content/uploads/2017/12/cropped-WP3-副本-192x192.jpg" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://www.tiaobug.com/wp-content/uploads/2017/12/cropped-WP3-副本-180x180.jpg" />
<meta name="msapplication-TileImage" content="http://www.tiaobug.com/wp-content/uploads/2017/12/cropped-WP3-副本-270x270.jpg" />
		<style type="text/css" id="wp-custom-css">
			/*
您可以在此处加入您的CSS。

点击上方的帮助图标来了解更多。
*/
.wrap {
    padding-bottom: 100px;
}
.bottom-info{
    clear: both;
    position: fixed;
    bottom: 0px;
    background-color: #e5e5e5;
    z-index: 1000;
    text-align: center;
    width: 100%;
}		</style>
	  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?d68c66f0010a97131e967e4bab927275";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</head>
<body class="home blog paged paged-6">
    
<header class="banner cover" role="banner">
  <div class="header-inner">
      <nav class="nav-main" role="navigation">
        <div class="container">
                </div>
      </nav>
              <hgroup>
          <div class="container">
            <h1 class="page-title" style="border:0px">
              <a href="http://www.tiaobug.com/contactme">攻城狮小武</a>
            </h1>
            <h2 class="page-description">tiaobug.com</h2>
            <button id="get-started" class="btn btn-default btn-coner">来都来了，瞅两眼吧！</button>
          </div>
        </hgroup>
        </div>
</header>  <div class="wrap container" role="document">
    <div class="content row">
      <main class="main col-sm-12" role="main">
        <div class="timeline two-col">
  <div data-page="1" class="timeline-pale dwtl full"><span>Page 1</span></div>
      <div class="timeline-scrubber"><ul><li  class="active"  data-page="1"><a href="#" >Page 1</a></li><li  data-page="2"><a href="#" >Page 2</a></li><li  data-page="3"><a href="#" >Page 3</a></li><li  data-page="4"><a href="#" >Page 4</a></li><li  data-page="5"><a href="#" >Page 5</a></li><li  data-page="6"><a href="#" >Page 6</a></li><li  data-page="7"><a href="#" >Page 7</a></li><li  data-page="8"><a href="#" >Page 8</a></li><li  data-page="9"><a href="#" >Page 9</a></li><li  data-page="10"><a href="#" >Page 10</a></li></ul></div>          <article data-page="6" class="post-262 post type-post status-publish format-link hentry category-uncategorized post_format-post-format-link dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">链接</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/262.html">发现阿里云的镜像竟然很全，而且速度真是不错。</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/262.html"><time class="published" datetime="2017-04-05T15:12:22+00:00">2017年4月5日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p>http://mirrors.aliyun.com</p>
<p>覆盖了Debian、Ubuntu、 Fedora、Arch Linux、 CentOS、openSUSE、Scientific Linux、Gentoo 等多个发行版的软件源镜像。</p>
    </div>
  </div>
</article>
          <article data-page="6" class="post-258 post type-post status-publish format-standard hentry category-uncategorized dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">标准</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/258.html">批量将图片切成四行两列的碎片</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/258.html"><time class="published" datetime="2017-03-31T17:02:16+00:00">2017年3月31日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p>项目中需要在leaflet上贴上单张地图，可是发现单张地图超过1M的话，加载会有延时，计划把地图批量切开，同时加载，效果应该不错。</p>
<p>事后证明这样是对的，加载时间确实有了提升。</p>
<p><a href="http://www.tiaobug.com/wp-content/uploads/2017/03/a-1.png"><img class="alignnone  wp-image-259" src="http://www.tiaobug.com/wp-content/uploads/2017/03/a-1.png" alt="" width="769" height="165" srcset="http://www.tiaobug.com/wp-content/uploads/2017/03/a-1.png 1235w, http://www.tiaobug.com/wp-content/uploads/2017/03/a-1-300x64.png 300w, http://www.tiaobug.com/wp-content/uploads/2017/03/a-1-768x165.png 768w, http://www.tiaobug.com/wp-content/uploads/2017/03/a-1-1024x220.png 1024w" sizes="(max-width: 769px) 100vw, 769px" /></a></p>
<p>&nbsp;</p>
<p>批量裁剪的代码：（处理过程中，牺牲了几个像素，防止出现裂缝。）</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170e9f785496093878" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import java.awt.Rectangle;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.util.Iterator;

import javax.imageio.ImageIO;
import javax.imageio.ImageReadParam;
import javax.imageio.ImageReader;
import javax.imageio.stream.ImageInputStream;


public class ImageCutter {
	/**
	 * 剪切点x坐标
	 */
	private int x;

	/**
	 * 剪切点y坐标
	 */
	private int y;

	/**
	 * 剪切点宽度
	 */
	private int width;

	/**
	 * 剪切点高度
	 */
	private int height;

	private String postfix = "png";

	public ImageCutter() {

	}

	public ImageCutter(int x, int y, int width, int height) {
		this.x = x;
		this.y = y;
		this.width = width;
		this.height = height;
	}

	/**
	 * 对图片裁剪，并把裁剪完蛋新图片保存 。
	 * 
	 * @param srcpath
	 *            源图片路径
	 * @param subpath
	 *            剪切图片存放路径
	 * @throws IOException
	 */
	public void cut(String srcpath, String subpath,int index) throws IOException {
		FileInputStream is = null;
		ImageInputStream iis = null;
		try {
			// 读取图片文件
			is = new FileInputStream(srcpath);

			Iterator&lt;ImageReader&gt; it = ImageIO.getImageReadersByFormatName(postfix);

			ImageReader reader = it.next();
			// 获取图片流
			iis = ImageIO.createImageInputStream(is);

			/*
			 * &lt;p&gt;iis:读取源.true:只向前搜索 &lt;/p&gt;.将它标记为 ‘只向前搜索’。
			 * 此设置意味着包含在输入源中的图像将只按顺序读取，可能允许 reader 避免缓存包含与以前已经读取的图像关联的数据的那些输入部分。
			 */
			reader.setInput(iis, true);

			/*
			 * &lt;p&gt;描述如何对流进行解码的类&lt;p&gt;.用于指定如何在输入时从 Java Image I/O
			 * 框架的上下文中的流转换一幅图像或一组图像。用于特定图像格式的插件 将从其 ImageReader 实现的
			 * getDefaultReadParam 方法中返回 ImageReadParam 的实例。
			 */
			ImageReadParam param = reader.getDefaultReadParam();

			/*
			 * 图片裁剪区域。Rectangle 指定了坐标空间中的一个区域，通过 Rectangle 对象
			 * 的左上顶点的坐标（x，y）、宽度和高度可以定义这个区域。
			 */
			Rectangle rect = new Rectangle(x, y, width, height);

			// 提供一个 BufferedImage，将其用作解码像素数据的目标。
			param.setSourceRegion(rect);
			/*
			 * 使用所提供的 ImageReadParam 读取通过索引 imageIndex 指定的对象，并将 它作为一个完整的
			 * BufferedImage 返回。
			 */
			BufferedImage bi = reader.read(0, param);
			File targetFolder = new File(subpath.replaceAll("."+postfix, "/"));
			if (!targetFolder.exists()) {
				targetFolder.mkdirs();
			}
			// 保存新图片
			ImageIO.write(bi, postfix, new File(subpath.replaceAll("."+postfix, "") + "/" + index + "." + postfix));
		} finally {
			if (is != null)
				is.close();
			if (iis != null)
				iis.close();
		}

	}
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-2">2</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-4">4</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-6">6</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-8">8</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-10">10</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-12">12</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-14">14</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-16">16</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-18">18</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-20">20</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-22">22</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-24">24</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-26">26</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-28">28</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-30">30</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-32">32</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-34">34</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-36">36</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-38">38</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-40">40</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-42">42</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-44">44</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-46">46</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-48">48</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-50">50</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-52">52</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-54">54</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-56">56</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-58">58</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-60">60</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-62">62</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-64">64</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-66">66</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-68">68</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-70">70</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-72">72</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-74">74</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-76">76</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-78">78</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-80">80</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-82">82</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-84">84</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-86">86</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-88">88</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-90">90</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-92">92</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-94">94</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-96">96</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-98">98</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-100">100</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-102">102</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-104">104</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-106">106</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-108">108</div><div class="crayon-num" data-line="crayon-5df7170e9f785496093878-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f785496093878-110">110</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170e9f785496093878-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">Rectangle</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">BufferedImage</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">File</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">FileInputStream</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">IOException</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">Iterator</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-8"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-9"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageReadParam</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-10"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageReader</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-11"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">stream</span><span class="crayon-sy">.</span><span class="crayon-v">ImageInputStream</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-12">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-14"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ImageCutter</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-15"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-16"><span class="crayon-c">	 * 剪切点x坐标</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-17"><span class="crayon-c">	 */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-18"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-20"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-21"><span class="crayon-c">	 * 剪切点y坐标</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-22"><span class="crayon-c">	 */</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-23"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-24">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-25"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-26"><span class="crayon-c">	 * 剪切点宽度</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-27"><span class="crayon-c">	 */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-28"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-30"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-31"><span class="crayon-c">	 * 剪切点高度</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-32"><span class="crayon-c">	 */</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-33"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-34">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-35"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">postfix</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"png"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-36">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-37"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">ImageCutter</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-38">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-39"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-40">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-41"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">ImageCutter</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-42"><span class="crayon-h">		</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-43"><span class="crayon-h">		</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-44"><span class="crayon-h">		</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-45"><span class="crayon-h">		</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-46"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-47">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-48"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-49"><span class="crayon-c">	 * 对图片裁剪，并把裁剪完蛋新图片保存 。</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-50"><span class="crayon-c">	 * </span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-51"><span class="crayon-c">	 * @param srcpath</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-52"><span class="crayon-c">	 *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;源图片路径</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-53"><span class="crayon-c">	 * @param subpath</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-54"><span class="crayon-c">	 *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;剪切图片存放路径</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-55"><span class="crayon-c">	 * @throws IOException</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-56"><span class="crayon-c">	 */</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-57"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">cut</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">srcpath</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">subpath</span><span class="crayon-sy">,</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-m">throws</span><span class="crayon-h"> </span><span class="crayon-e">IOException</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-58"><span class="crayon-h">		</span><span class="crayon-e">FileInputStream </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-59"><span class="crayon-h">		</span><span class="crayon-e">ImageInputStream </span><span class="crayon-v">iis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-60"><span class="crayon-h">		</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-61"><span class="crayon-h">			</span><span class="crayon-c">// 读取图片文件</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-62"><span class="crayon-h">			</span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FileInputStream</span><span class="crayon-sy">(</span><span class="crayon-v">srcpath</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-63">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-64"><span class="crayon-h">			</span><span class="crayon-v">Iterator</span><span class="crayon-e ">&lt;ImageReader&gt;</span><span class="crayon-h"> </span><span class="crayon-v">it</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">getImageReadersByFormatName</span><span class="crayon-sy">(</span><span class="crayon-v">postfix</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-65">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-66"><span class="crayon-h">			</span><span class="crayon-e">ImageReader </span><span class="crayon-v">reader</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">it</span><span class="crayon-sy">.</span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-67"><span class="crayon-h">			</span><span class="crayon-c">// 获取图片流</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-68"><span class="crayon-h">			</span><span class="crayon-v">iis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">createImageInputStream</span><span class="crayon-sy">(</span><span class="crayon-st">is</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-69">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-70"><span class="crayon-h">			</span><span class="crayon-c">/*</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-71"><span class="crayon-c">			 * &lt;p&gt;iis:读取源.true:只向前搜索 &lt;/p&gt;.将它标记为 ‘只向前搜索’。</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-72"><span class="crayon-c">			 * 此设置意味着包含在输入源中的图像将只按顺序读取，可能允许 reader 避免缓存包含与以前已经读取的图像关联的数据的那些输入部分。</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-73"><span class="crayon-c">			 */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-74"><span class="crayon-h">			</span><span class="crayon-v">reader</span><span class="crayon-sy">.</span><span class="crayon-e">setInput</span><span class="crayon-sy">(</span><span class="crayon-v">iis</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-75">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-76"><span class="crayon-h">			</span><span class="crayon-c">/*</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-77"><span class="crayon-c">			 * &lt;p&gt;描述如何对流进行解码的类&lt;p&gt;.用于指定如何在输入时从 Java Image I/O</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-78"><span class="crayon-c">			 * 框架的上下文中的流转换一幅图像或一组图像。用于特定图像格式的插件 将从其 ImageReader 实现的</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-79"><span class="crayon-c">			 * getDefaultReadParam 方法中返回 ImageReadParam 的实例。</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-80"><span class="crayon-c">			 */</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-81"><span class="crayon-h">			</span><span class="crayon-e">ImageReadParam </span><span class="crayon-v">param</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">reader</span><span class="crayon-sy">.</span><span class="crayon-e">getDefaultReadParam</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-82">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-83"><span class="crayon-h">			</span><span class="crayon-c">/*</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-84"><span class="crayon-c">			 * 图片裁剪区域。Rectangle 指定了坐标空间中的一个区域，通过 Rectangle 对象</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-85"><span class="crayon-c">			 * 的左上顶点的坐标（x，y）、宽度和高度可以定义这个区域。</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-86"><span class="crayon-c">			 */</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-87"><span class="crayon-h">			</span><span class="crayon-e">Rectangle </span><span class="crayon-v">rect</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Rectangle</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-88">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-89"><span class="crayon-h">			</span><span class="crayon-c">// 提供一个 BufferedImage，将其用作解码像素数据的目标。</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-90"><span class="crayon-h">			</span><span class="crayon-v">param</span><span class="crayon-sy">.</span><span class="crayon-e">setSourceRegion</span><span class="crayon-sy">(</span><span class="crayon-v">rect</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-91"><span class="crayon-h">			</span><span class="crayon-c">/*</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-92"><span class="crayon-c">			 * 使用所提供的 ImageReadParam 读取通过索引 imageIndex 指定的对象，并将 它作为一个完整的</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-93"><span class="crayon-c">			 * BufferedImage 返回。</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-94"><span class="crayon-c">			 */</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-95"><span class="crayon-h">			</span><span class="crayon-e">BufferedImage </span><span class="crayon-v">bi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">reader</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">param</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-96"><span class="crayon-h">			</span><span class="crayon-e">File </span><span class="crayon-v">targetFolder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">File</span><span class="crayon-sy">(</span><span class="crayon-v">subpath</span><span class="crayon-sy">.</span><span class="crayon-e">replaceAll</span><span class="crayon-sy">(</span><span class="crayon-s">"."</span><span class="crayon-o">+</span><span class="crayon-v">postfix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"/"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-97"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">targetFolder</span><span class="crayon-sy">.</span><span class="crayon-e">exists</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-98"><span class="crayon-h">				</span><span class="crayon-v">targetFolder</span><span class="crayon-sy">.</span><span class="crayon-e">mkdirs</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-99"><span class="crayon-h">			</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-100"><span class="crayon-h">			</span><span class="crayon-c">// 保存新图片</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-101"><span class="crayon-h">			</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">bi</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">postfix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">File</span><span class="crayon-sy">(</span><span class="crayon-v">subpath</span><span class="crayon-sy">.</span><span class="crayon-e">replaceAll</span><span class="crayon-sy">(</span><span class="crayon-s">"."</span><span class="crayon-o">+</span><span class="crayon-v">postfix</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"/"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"."</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">postfix</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-102"><span class="crayon-h">		</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">finally</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-103"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-104"><span class="crayon-h">				</span><span class="crayon-st">is</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-105"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">iis</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-106"><span class="crayon-h">				</span><span class="crayon-v">iis</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f785496093878-107"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-108">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f785496093878-109"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f785496093878-110"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0137 seconds] -->
<p>&nbsp;</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170e9f795179399518" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import java.util.HashMap;
import java.util.Map;

public class RectangleCalc {
	public static Map&lt;String, Integer&gt; getRectangles(int width, int height) {

		// 把高度和宽度都变成偶数
		width = width / 2 * 2;
		height = height / 4 * 4;

		int littleWidth = width / 2;
		int littleHeight = height / 4;

		HashMap&lt;String, Integer&gt; rectangles = new HashMap&lt;&gt;();
		int halfX = width / 2;
		int halfY = height / 2;
		int quarterY = height / 4;
		
		
		rectangles.put("1x",0);
		rectangles.put("3x",0);
		rectangles.put("5x",0);
		rectangles.put("7x",0);
		rectangles.put("2x",halfX);
		rectangles.put("4x",halfX);
		rectangles.put("6x",halfX);
		rectangles.put("8x",halfX);
		
		rectangles.put("1y",0);
		rectangles.put("2y",0);
		rectangles.put("3y",quarterY);
		rectangles.put("4y",quarterY);
		rectangles.put("5y",halfY);
		rectangles.put("6y",halfY);
		rectangles.put("7y",halfY+quarterY);
		rectangles.put("8y",halfY+quarterY);

		rectangles.put("littleWidth", littleWidth);
		rectangles.put("littleHeight", littleHeight);

		/// rectangles.put("0", []);
		return rectangles;
	}
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-2">2</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-4">4</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-6">6</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-8">8</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-10">10</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-12">12</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-14">14</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-16">16</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-18">18</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-20">20</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-22">22</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-24">24</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-26">26</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-28">28</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-30">30</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-32">32</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-34">34</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-36">36</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-38">38</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-40">40</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-42">42</div><div class="crayon-num" data-line="crayon-5df7170e9f795179399518-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f795179399518-44">44</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170e9f795179399518-1"><span class="crayon-e">import </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">HashMap</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-2"><span class="crayon-e">import </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">Map</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-4"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">RectangleCalc</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-5"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-v">Map</span><span class="crayon-o">&lt;</span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Integer</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-e">getRectangles</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-6">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f795179399518-7"><span class="crayon-h">		</span><span class="crayon-c">// 把高度和宽度都变成偶数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-8"><span class="crayon-h">		</span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-9"><span class="crayon-h">		</span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-10">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f795179399518-11"><span class="crayon-h">		</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">littleWidth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-12"><span class="crayon-h">		</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">littleHeight</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-14"><span class="crayon-h">		</span><span class="crayon-v">HashMap</span><span class="crayon-o">&lt;</span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Integer</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">rectangles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">HashMap</span><span class="crayon-o">&lt;&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-15"><span class="crayon-h">		</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">halfX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-16"><span class="crayon-h">		</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">halfY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-17"><span class="crayon-h">		</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">quarterY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">4</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-18"><span class="crayon-h">		</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-19"><span class="crayon-h">		</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-20"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"1x"</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-21"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"3x"</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-22"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"5x"</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-23"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"7x"</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-24"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"2x"</span><span class="crayon-sy">,</span><span class="crayon-v">halfX</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-25"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"4x"</span><span class="crayon-sy">,</span><span class="crayon-v">halfX</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-26"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"6x"</span><span class="crayon-sy">,</span><span class="crayon-v">halfX</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-27"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"8x"</span><span class="crayon-sy">,</span><span class="crayon-v">halfX</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-28"><span class="crayon-h">		</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-29"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"1y"</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-30"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"2y"</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-31"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"3y"</span><span class="crayon-sy">,</span><span class="crayon-v">quarterY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-32"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"4y"</span><span class="crayon-sy">,</span><span class="crayon-v">quarterY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-33"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"5y"</span><span class="crayon-sy">,</span><span class="crayon-v">halfY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-34"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"6y"</span><span class="crayon-sy">,</span><span class="crayon-v">halfY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-35"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"7y"</span><span class="crayon-sy">,</span><span class="crayon-v">halfY</span><span class="crayon-o">+</span><span class="crayon-v">quarterY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-36"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"8y"</span><span class="crayon-sy">,</span><span class="crayon-v">halfY</span><span class="crayon-o">+</span><span class="crayon-v">quarterY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-38"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"littleWidth"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">littleWidth</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-39"><span class="crayon-h">		</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">put</span><span class="crayon-sy">(</span><span class="crayon-s">"littleHeight"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">littleHeight</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-40">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f795179399518-41"><span class="crayon-h">		</span><span class="crayon-c">/// rectangles.put("0", []);</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-42"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">rectangles</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f795179399518-43"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f795179399518-44"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0102 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170e9f79c618042528" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.Map;

import javax.imageio.ImageIO;

public class Cutter {

	public static final String srcPath = "e:/a/";
	public static final String destPath = "e:/b/";

	public static void main(String[] args) {
		File file = new File(srcPath);
		File[] tempList = file.listFiles();
		System.out.println("预计执行个数：" + tempList.length);
		for (int i = 0; i &lt; tempList.length; i++) {
			System.out.println("处理文件：" + tempList[i]);
			BufferedImage bufferedImage;
			try {
				bufferedImage = ImageIO.read(tempList[i]);
				int width = bufferedImage.getWidth();
				int height = bufferedImage.getHeight();
				Map&lt;String, Integer&gt; rectangles = RectangleCalc.getRectangles(width, height);

				for (int j = 1; j &lt;= 8; j++) {

					ImageCutter imageCut = new ImageCutter(rectangles.get(j+"x"), rectangles.get(j+"y"), rectangles.get("littleWidth"), rectangles.get("littleHeight"));
					imageCut.cut(tempList[i].getPath(), destPath + tempList[i].getName(), j);
				}

			} catch (IOException e) {
				e.printStackTrace();
			}

		}
	}
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-2">2</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-4">4</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-6">6</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-8">8</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-10">10</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-12">12</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-14">14</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-16">16</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-18">18</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-20">20</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-22">22</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-24">24</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-26">26</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-28">28</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-30">30</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-32">32</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-34">34</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-36">36</div><div class="crayon-num" data-line="crayon-5df7170e9f79c618042528-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170e9f79c618042528-38">38</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170e9f79c618042528-1"><span class="crayon-e">import </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">awt</span><span class="crayon-sy">.</span><span class="crayon-v">image</span><span class="crayon-sy">.</span><span class="crayon-v">BufferedImage</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-2"><span class="crayon-e">import </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">File</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-3"><span class="crayon-e">import </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">io</span><span class="crayon-sy">.</span><span class="crayon-v">IOException</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-4"><span class="crayon-e">import </span><span class="crayon-v">java</span><span class="crayon-sy">.</span><span class="crayon-v">util</span><span class="crayon-sy">.</span><span class="crayon-v">Map</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-6"><span class="crayon-e">import </span><span class="crayon-v">javax</span><span class="crayon-sy">.</span><span class="crayon-v">imageio</span><span class="crayon-sy">.</span><span class="crayon-v">ImageIO</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-8"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">Cutter</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-10"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">srcPath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"e:/a/"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-11"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">destPath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"e:/b/"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-12">&nbsp;</div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-13"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-14"><span class="crayon-h">		</span><span class="crayon-e">File </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">File</span><span class="crayon-sy">(</span><span class="crayon-v">srcPath</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-15"><span class="crayon-h">		</span><span class="crayon-v">File</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">tempList</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">listFiles</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-16"><span class="crayon-h">		</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">out</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"预计执行个数："</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tempList</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-17"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">tempList</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-18"><span class="crayon-h">			</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">out</span><span class="crayon-sy">.</span><span class="crayon-e">println</span><span class="crayon-sy">(</span><span class="crayon-s">"处理文件："</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tempList</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-19"><span class="crayon-h">			</span><span class="crayon-e">BufferedImage </span><span class="crayon-v">bufferedImage</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-20"><span class="crayon-h">			</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-21"><span class="crayon-h">				</span><span class="crayon-v">bufferedImage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImageIO</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-v">tempList</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-22"><span class="crayon-h">				</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">width</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">bufferedImage</span><span class="crayon-sy">.</span><span class="crayon-e">getWidth</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-23"><span class="crayon-h">				</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">bufferedImage</span><span class="crayon-sy">.</span><span class="crayon-e">getHeight</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-24"><span class="crayon-h">				</span><span class="crayon-v">Map</span><span class="crayon-o">&lt;</span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Integer</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">rectangles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">RectangleCalc</span><span class="crayon-sy">.</span><span class="crayon-e">getRectangles</span><span class="crayon-sy">(</span><span class="crayon-v">width</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">height</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-26"><span class="crayon-h">				</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span class="crayon-h"> </span><span class="crayon-cn">8</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-o">++</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-28"><span class="crayon-h">					</span><span class="crayon-e">ImageCutter </span><span class="crayon-v">imageCut</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ImageCutter</span><span class="crayon-sy">(</span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-s">"x"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">j</span><span class="crayon-o">+</span><span class="crayon-s">"y"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"littleWidth"</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rectangles</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"littleHeight"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-29"><span class="crayon-h">					</span><span class="crayon-v">imageCut</span><span class="crayon-sy">.</span><span class="crayon-e">cut</span><span class="crayon-sy">(</span><span class="crayon-v">tempList</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">getPath</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">destPath</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">tempList</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">getName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-30"><span class="crayon-h">				</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-32"><span class="crayon-h">			</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">IOException</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-33"><span class="crayon-h">				</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">printStackTrace</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-34"><span class="crayon-h">			</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-36"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170e9f79c618042528-37"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170e9f79c618042528-38"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0185 seconds] -->
<p>&nbsp;</p>
    </div>
  </div>
</article>
          <article data-page="6" class="post-255 post type-post status-publish format-status hentry category-uncategorized post_format-post-format-status dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">状态</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/255.html">昨晚加班到九点，把公司的网络进行了切换，整体质量和管控都得到提升，今早看到一切顺利，全部同事能上网，舒畅！</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/255.html"><time class="published" datetime="2017-03-31T10:22:21+00:00">2017年3月31日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
          </div>
  </div>
</article>
          <article data-page="6" class="post-252 post type-post status-publish format-standard hentry category-uncategorized dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">标准</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/252.html">Maven打包动态替换配置文件变量的问题，在eclipse中发布失效的问题</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/252.html"><time class="published" datetime="2017-03-30T09:59:04+00:00">2017年3月30日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p>在开发过程中，在&#8221;开发&#8221;，&#8221;仿真&#8221;，&#8221;正式部署&#8221;三种环境中，往往数据库配置，日志输出配置等都会不同，如果每次都手动改，显然不够优雅，Maven自带的工具可以解决这一问题，可以参考这里。</p>
<p>http://blog.csdn.net/xiao_jun_0820/article/details/49864285</p>
<p>但是，在eclipse中会发现这一配置无法奏效，查找原因浪费了一点时间。</p>
<p>总结一下：</p>
<p>1，先要确认发布到eclipse的代码是maven替换配置文件后的代码，eclipse自带的tomcat的发布路径是：  .metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps</p>
<p>2，如果发现，配置文件里的类似于${jdbc.url}的字符串没有被替换掉，那就是eclipse的配置出问题了，需要确认改动两个地方：</p>
<ul>
<li>web项目的java编译代码的路径。在项目上点右键&#8211;properties&#8211;java build pah&#8211;default output folder 设置成 project name/target/classes</li>
<li>web项目的deploy 路径改动。在项目上点右键&#8211;properties&#8211;deployment assembly &#8212; 设置成如下的结构<a href="http://www.tiaobug.com/wp-content/uploads/2017/03/a.png"><img class="alignnone size-full wp-image-253" src="http://www.tiaobug.com/wp-content/uploads/2017/03/a.png" alt="" width="741" height="263" srcset="http://www.tiaobug.com/wp-content/uploads/2017/03/a.png 741w, http://www.tiaobug.com/wp-content/uploads/2017/03/a-300x106.png 300w" sizes="(max-width: 741px) 100vw, 741px" /></a></li>
</ul>
<p>&nbsp;</p>
<p>这样就基本能保证maven编译替换的文件能及时的部署到自带的tomcat中去。</p>
    </div>
  </div>
</article>
          <article data-page="6" class="post-249 post type-post status-publish format-standard hentry category-uncategorized dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">标准</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/249.html">利用Shell脚本给微信企业号里定时推送消息</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/249.html"><time class="published" datetime="2017-03-29T10:06:25+00:00">2017年3月29日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p>进去企业号https://qy.weixin.qq.com</p>
<p>应用中心&#8211;新建应用&#8211;消息性应用&#8211;添加LOGO&#8211;填入名称和介绍&#8211;选择一个可见范围（建议选最大组织）。</p>
<p>点开应用查看应用的ID。</p>
<p>&nbsp;</p>
<p>打开设置&#8211;权限管理&#8211;查看CorpID和Secret。</p>
<p>通讯录&#8211;点击&#8221;最高级别组织&#8221;右边的三角号&#8211;修改部门&#8211;查看部门id.</p>
<p>&nbsp;</p>
<p>shell脚本：</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170ea3472418354433" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Shell</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#!/bin/sh

URL_GET_TOKEN="https://qyapi.weixin.qq.com/cgi-bin/gettoken"
URL_SEND_MSG="https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token="
CORP_ID="wx72800000000000"
SECRET="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
#部门ID
TOPARTY=1
#应用ID
AGENTID=92

MSG='{'
MSG=$MSG'"toparty":"'$TOPARTY'",'
MSG=$MSG'"text":{"content":"'同学们，请及时提交今日日报！'"},'
MSG=$MSG'"safe":"0",'
MSG=$MSG'"agentid":'$AGENTID','
MSG=$MSG'"msgtype":"text"'
MSG=$MSG'}'

TOKEN=$(curl -s "$URL_GET_TOKEN?corpid=$CORP_ID&amp;corpsecret=$SECRET" | jq -r .access_token)

if [ -z $TOKEN ]; then
    echo Get token error, maybe network issue
    exit 100
fi
echo $MSG
return=$(curl -s -X POST -d "$MSG" $URL_SEND_MSG$TOKEN)

if [ -z "$return" ]; then
    echo Send msg error, maybe network issue
    exit 101
else
    errcode=$(echo $return | jq -r .errcode)
    if [[ $errcode -ne 0 ]]; then
        errmsg=$(echo $return | jq -r .errmsg)
        echo Send msg error, with error $errcode: $errmsg
        exit 102
    else
        echo ok
    fi
fi</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-2">2</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-4">4</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-6">6</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-8">8</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-10">10</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-12">12</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-14">14</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-16">16</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-18">18</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-20">20</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-22">22</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-24">24</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-26">26</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-28">28</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-30">30</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-32">32</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-34">34</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-36">36</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-38">38</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3472418354433-40">40</div><div class="crayon-num" data-line="crayon-5df7170ea3472418354433-41">41</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170ea3472418354433-1"><span class="crayon-p">#!/bin/sh</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-2">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3472418354433-3"><span class="crayon-v">URL_GET_TOKEN</span><span class="crayon-o">=</span><span class="crayon-s">"https://qyapi.weixin.qq.com/cgi-bin/gettoken"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-4"><span class="crayon-v">URL_SEND_MSG</span><span class="crayon-o">=</span><span class="crayon-s">"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token="</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-5"><span class="crayon-v">CORP_ID</span><span class="crayon-o">=</span><span class="crayon-s">"wx72800000000000"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-6"><span class="crayon-v">SECRET</span><span class="crayon-o">=</span><span class="crayon-s">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-7"><span class="crayon-c">#部门ID</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-8"><span class="crayon-v">TOPARTY</span><span class="crayon-o">=</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-9"><span class="crayon-c">#应用ID</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-10"><span class="crayon-v">AGENTID</span><span class="crayon-o">=</span><span class="crayon-cn">92</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-12"><span class="crayon-v">MSG</span><span class="crayon-o">=</span><span class="crayon-s">'{'</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-13"><span class="crayon-v">MSG</span><span class="crayon-o">=</span><span class="crayon-v">$MSG</span><span class="crayon-s">'"toparty":"'</span><span class="crayon-v">$TOPARTY</span><span class="crayon-s">'",'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-14"><span class="crayon-v">MSG</span><span class="crayon-o">=</span><span class="crayon-v">$MSG</span><span class="crayon-s">'"text":{"content":"'</span>同学们，请及时提交今日日报！<span class="crayon-s">'"},'</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-15"><span class="crayon-v">MSG</span><span class="crayon-o">=</span><span class="crayon-v">$MSG</span><span class="crayon-s">'"safe":"0",'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-16"><span class="crayon-v">MSG</span><span class="crayon-o">=</span><span class="crayon-v">$MSG</span><span class="crayon-s">'"agentid":'</span><span class="crayon-v">$AGENTID</span><span class="crayon-s">','</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-17"><span class="crayon-v">MSG</span><span class="crayon-o">=</span><span class="crayon-v">$MSG</span><span class="crayon-s">'"msgtype":"text"'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-18"><span class="crayon-v">MSG</span><span class="crayon-o">=</span><span class="crayon-v">$MSG</span><span class="crayon-s">'}'</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-20"><span class="crayon-v">TOKEN</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-v">curl</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-s">"$URL_GET_TOKEN?corpid=$CORP_ID&amp;corpsecret=$SECRET"</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">jq</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-e">.access_token</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-22"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">z</span><span class="crayon-h"> </span><span class="crayon-v">$TOKEN</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-st">then</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-r">Get</span><span class="crayon-h"> </span><span class="crayon-e">token </span><span class="crayon-v">error</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">maybe </span><span class="crayon-e">network </span><span class="crayon-e">issue</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-24"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">exit</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-25"><span class="crayon-st">fi</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-26"><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-v">$MSG</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-27"><span class="crayon-st">return</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-v">curl</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">X</span><span class="crayon-h"> </span><span class="crayon-v">POST</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-s">"$MSG"</span><span class="crayon-h"> </span><span class="crayon-v">$URL_SEND_MSG</span><span class="crayon-v">$TOKEN</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-28">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3472418354433-29"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">z</span><span class="crayon-h"> </span><span class="crayon-s">"$return"</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-st">then</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-e">Send </span><span class="crayon-e">msg </span><span class="crayon-v">error</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">maybe </span><span class="crayon-e">network </span><span class="crayon-e">issue</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-31"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">exit</span><span class="crayon-h"> </span><span class="crayon-cn">101</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-32"><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">errcode</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-v">$return</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">jq</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-e">.errcode</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-v">$errcode</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">ne</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-st">then</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">errmsg</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-v">$return</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">jq</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">r</span><span class="crayon-h"> </span><span class="crayon-e">.errmsg</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-e">Send </span><span class="crayon-e">msg </span><span class="crayon-v">error</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">with </span><span class="crayon-i">error</span><span class="crayon-h"> </span><span class="crayon-v">$errcode</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">$errmsg</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">exit</span><span class="crayon-h"> </span><span class="crayon-cn">102</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">echo</span><span class="crayon-h"> </span><span class="crayon-e">ok</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3472418354433-40"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">fi</span></div><div class="crayon-line" id="crayon-5df7170ea3472418354433-41"><span class="crayon-st">fi</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0103 seconds] -->
<p>&nbsp;</p>
<p>加入定时器crontab里定时执行脚本，就可以每天通过企业号应用进行通知了。</p>
<p>最终的效果：</p>
<p><a href="http://www.tiaobug.com/wp-content/uploads/2017/03/微信图片_20170329100436.jpg" rel="attachment wp-att-250"><img class="alignnone  wp-image-250" src="http://www.tiaobug.com/wp-content/uploads/2017/03/微信图片_20170329100436.jpg" alt="微信图片_20170329100436" width="283" height="503" srcset="http://www.tiaobug.com/wp-content/uploads/2017/03/微信图片_20170329100436.jpg 720w, http://www.tiaobug.com/wp-content/uploads/2017/03/微信图片_20170329100436-169x300.jpg 169w, http://www.tiaobug.com/wp-content/uploads/2017/03/微信图片_20170329100436-576x1024.jpg 576w" sizes="(max-width: 283px) 100vw, 283px" /></a></p>
<p>&nbsp;</p>
    </div>
  </div>
</article>
          <article data-page="6" class="post-246 post type-post status-publish format-standard hentry category-17 dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">标准</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/246.html">移过来移过去，最后还是迁移到了阿里云里，老了，不愿意再折腾了。</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/246.html"><time class="published" datetime="2017-03-28T10:16:13+00:00">2017年3月28日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/%e6%97%a5%e5%b8%b8" rel="category tag">日常</a></span>
</div>
    </header>
    <div class="entry-content">
          </div>
  </div>
</article>
          <article data-page="6" class="post-236 post type-post status-publish format-link hentry category-uncategorized post_format-post-format-link dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">链接</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/236.html">这只小鸟很完美：推特客户端 Twidere</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/236.html"><time class="published" datetime="2016-12-15T15:29:41+00:00">2016年12月15日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p>http://sspai.com/25269/</p>
    </div>
  </div>
</article>
          <article data-page="6" class="post-228 post type-post status-publish format-standard hentry category-uncategorized dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">标准</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/228.html">把数据源的类库从C3P0换成了Hikari，本地查询都能感觉出来有提升</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/228.html"><time class="published" datetime="2016-11-07T14:56:31+00:00">2016年11月7日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p>http://brettwooldridge.github.io/HikariCP/</p>
<h5></h5>
<p>下图可以结论无论是Connection回收还是Statement回收，Hikari要比C3P0高不止一个档次，在数据库查询成为系统瓶颈是，<span style="color: #3366ff;">这个数据源配置值得一换。</span></p>
<p><a href="http://www.tiaobug.com/wp-content/uploads/2016/11/HikariCP-bench-2.4.0.png" rel="attachment wp-att-229"><img class="alignnone size-full wp-image-229" src="http://www.tiaobug.com/wp-content/uploads/2016/11/HikariCP-bench-2.4.0.png" alt="hikaricp-bench-2-4-0" width="781" height="334" srcset="http://www.tiaobug.com/wp-content/uploads/2016/11/HikariCP-bench-2.4.0.png 781w, http://www.tiaobug.com/wp-content/uploads/2016/11/HikariCP-bench-2.4.0-300x128.png 300w, http://www.tiaobug.com/wp-content/uploads/2016/11/HikariCP-bench-2.4.0-768x328.png 768w" sizes="(max-width: 781px) 100vw, 781px" /></a></p>
<p>&nbsp;</p>
<ul>
<li>One <em>Connection Cycle</em> is defined as single <code>DataSource.getConnection()</code>/<code>Connection.close()</code>.
<ul>
<li>In <em>Unconstrained</em> benchmark, connections &gt; threads.</li>
<li>In <em>Constrained</em> benchmark, threads &gt; connections (2:1).</li>
</ul>
</li>
<li>One <em>Statement Cycle</em> is defined as single <code>Connection.prepareStatement()</code>, <code>Statement.execute()</code>, <code>Statement.close()</code>.</li>
</ul>
<p><sup><sup>1</sup> Versions: HikariCP 2.4.0, commons-dbcp2 2.1, Tomcat 8.0.23, Vibur 3.0, c3p0 0.9.5.1, Java 8u45<br />
<sup>2</sup> Java options: -server -XX:+AggressiveOpts -XX:+UseFastAccessorMethods -Xmx512m<br />
</sup></p>
<p>Hikari并不是一味的快速创建和销毁资源，而是尽量使用稳定的资源完全无限的工作，这个思路和Spring的思路及其的类似。</p>
<p>下图可看出，Hikari引入后connection的数量稳定在80个左右，资源占用的稳定，这样就不会引起内存和CPU的抖动。</p>
<p>好的系统设计并<strong><span style="text-decoration: underline;"><span style="color: #ff0000; text-decoration: underline;">不一定是小的占用，而是稳定的占用</span></span></strong>。</p>
<hr />
<h5></h5>
<p><a href="http://www.tiaobug.com/wp-content/uploads/2016/11/2.png" rel="attachment wp-att-230"><img class="alignnone size-full wp-image-230" src="http://www.tiaobug.com/wp-content/uploads/2016/11/2.png" alt="2" width="779" height="204" srcset="http://www.tiaobug.com/wp-content/uploads/2016/11/2.png 779w, http://www.tiaobug.com/wp-content/uploads/2016/11/2-300x79.png 300w, http://www.tiaobug.com/wp-content/uploads/2016/11/2-768x201.png 768w" sizes="(max-width: 779px) 100vw, 779px" /></a></p>
    </div>
  </div>
</article>
          <article data-page="6" class="post-223 post type-post status-publish format-standard hentry category-uncategorized dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">标准</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/223.html">【职业病】  margin-right: -100px !important;</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/223.html"><time class="published" datetime="2016-10-31T17:13:27+00:00">2016年10月31日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p><a href="http://www.tiaobug.com/wp-content/uploads/2016/10/115图片20161031170419.jpg" rel="attachment wp-att-224"><img class="alignnone size-medium wp-image-224" src="http://www.tiaobug.com/wp-content/uploads/2016/10/115图片20161031170419-300x300.jpg" alt="115%e5%9b%be%e7%89%8720161031170419" width="300" height="300" srcset="http://www.tiaobug.com/wp-content/uploads/2016/10/115图片20161031170419-300x300.jpg 300w, http://www.tiaobug.com/wp-content/uploads/2016/10/115图片20161031170419-150x150.jpg 150w, http://www.tiaobug.com/wp-content/uploads/2016/10/115图片20161031170419-768x768.jpg 768w, http://www.tiaobug.com/wp-content/uploads/2016/10/115图片20161031170419-1024x1024.jpg 1024w, http://www.tiaobug.com/wp-content/uploads/2016/10/115图片20161031170419.jpg 1200w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
    </div>
  </div>
</article>
          <article data-page="6" class="post-217 post type-post status-publish format-aside hentry category-uncategorized post_format-post-format-aside dwtl normal">
  <div class="entry-inner">
        <div class="entry-format">日志</div>
    <header>
      <h2 class="entry-title"><a href="http://www.tiaobug.com/archives/217.html">Stateless Authentication using Spring and SpringMVC without store token</a></h2>
      <div class="entry-meta">
	<span class="entry-author">
				<span class="byline author vcard">
			By <a href="http://www.tiaobug.com/archives/author/admin" rel="author" class="fn">武鹏</a>
		</span>
	</span>
	<span class="sep">&bull;</span>
	<span class="entry-date">On <a href="http://www.tiaobug.com/archives/217.html"><time class="published" datetime="2016-10-27T15:39:08+00:00">2016年10月27日</time></a></span>
	<span class="sep">&bull;</span>
	<span class="cat-links">In 
	<a href="http://www.tiaobug.com/archives/category/uncategorized" rel="category tag">技术总结分享</a></span>
</div>
    </header>
    <div class="entry-content">
      <p><strong>中文标题</strong>：<strong>利用Spring和SpringMVC完成无状态的鉴权服务，并且不存储Token</strong></p>
<p>最近工作中，对开放给APP的API service的authentication module做了一些架构上的调整，主要完成了如下目标：</p>
<p>1，客户端（APP, web）登录后使用token进行鉴权。</p>
<p>2，支持集群部署。</p>
<p>3，彻底放弃session。</p>
<p>4，token不存储。（无论放到DB还是缓存中，都是一种消耗，token多的情况下，查询的开销也不小）。</p>
<p>&nbsp;</p>
<p>思路：</p>
<blockquote><p>之前查询过相关内容，最显著存在的问题是要依赖存储Token，这个存储的问题始终是一个梗，让我感觉不舒服，而且万一存储token的redis坏掉，那么整个系统瞬间会挂掉，集群带来的备份性又变成单一节点的限制，不能忍。想来想去，有个方法是可以尝试的，就是利用token本身的字符串来存储信息，具体做法是生成token的时候利用User对象生成的ObjectOutputStream然后加工一下，验证token的时候，把字符串再次转义成User，如果能成功则说明授权可以，如果不能成功则说明授权失败。朝着这个思路，找了很久发现了一个大神是这样搞的，文章是英文的，戳<span style="color: #0000ff;"><em><strong><a style="color: #0000ff;" href="https://www.javacodegeeks.com/2014/10/stateless-spring-security-part-2-stateless-authentication.html?utm_source=tuicool&amp;utm_medium=referral">这里</a></strong></em></span>。</p>
<p>感谢Arthur Arts.</p>
<p>He is an experienced Enterprise Java software engineer and hands-on Agile Coach and Scrum Master. He has a strong focus on agile engineering principles and practices and loves to share his knowledge and learn from others. He has his own company Coded Value, is a passionate photographer and writes for <a href="http://agilearts.nl/">agilearts.nl</a>.</p>
<p>&nbsp;</p>
<p>不过可惜是SpringSecurity实现的，对这个框架一直无感，对数据库的表有要求，而且后期如果做第三方的鉴权登录，也是个问题。但是只要思路证明可行，这都不是事，动手把它改成SpringMVC的拦截器直接实现。</p></blockquote>
<p><strong>首先要搞定的是TokenHandler（token的生成和鉴权的工具类）</strong></p>
<p>主要使用的是两个方法createTokenForUser(UserFront user)和createTokenForUser(UserFront user)，具体的实现方法请参考下面的类。这个类大部分是Arthur Arts。</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170ea3c3c230073566" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
public final class TokenHandler {

	private static final String HMAC_ALGO = "HmacSHA256";
	private static final String SEPARATOR = ".";
	private static final String SEPARATOR_SPLITTER = "\\.";

	private final Mac hmac;

	public TokenHandler(byte[] secretKey) {
		try {
			hmac = Mac.getInstance(HMAC_ALGO);
			hmac.init(new SecretKeySpec(secretKey, HMAC_ALGO));
		} catch (NoSuchAlgorithmException | InvalidKeyException e) {
			throw new IllegalStateException("failed to initialize HMAC: " + e.getMessage(), e);
		}
	}

	public UserFront parseUserFromToken(String token) {

		final String[] parts = token.split(SEPARATOR_SPLITTER);
		if (parts.length == 2 &amp;&amp; parts[0].length() &gt; 0 &amp;&amp; parts[1].length() &gt; 0) {
			try {
				final byte[] userBytes = fromBase64(parts[0]);
				final byte[] hash = fromBase64(parts[1]);

				boolean validHash = Arrays.equals(createHmac(userBytes), hash);
				if (validHash) {
					final UserFront userFront = fromJSON(userBytes);
					// if (new Date().getTime() &lt; userFront.get) {
					 return userFront;
					// }
				}
			} catch (IllegalArgumentException e) {
				e.printStackTrace();
				return null;
			}
		}
		return null;
	}

	public String createTokenForUser(UserFront user) {

		byte[] userBytes = toJSON(user);
		byte[] hash = createHmac(userBytes);
		final StringBuilder sb = new StringBuilder(170);
		sb.append(toBase64(userBytes));
		sb.append(SEPARATOR);
		sb.append(toBase64(hash));
		return sb.toString();
	}

	private UserFront fromJSON(final byte[] userBytes) {

		try {
			return new ObjectMapper().readValue(new ByteArrayInputStream(userBytes), UserFront.class);
		} catch (IOException e) {
			throw new IllegalStateException(e);
		}
	}

	private byte[] toJSON(UserFront user) {

		try {
			return new ObjectMapper().writeValueAsBytes(user);
		} catch (JsonProcessingException e) {
			throw new IllegalStateException(e);
		}
	}

	private String toBase64(byte[] content) {

		return DatatypeConverter.printBase64Binary(content);
	}

	private byte[] fromBase64(String content) {

		return DatatypeConverter.parseBase64Binary(content);
	}

	// synchronized to guard internal hmac object
	private synchronized byte[] createHmac(byte[] content) {

		return hmac.doFinal(content);
	}
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-2">2</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-4">4</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-6">6</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-8">8</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-10">10</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-12">12</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-14">14</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-16">16</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-18">18</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-20">20</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-22">22</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-24">24</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-26">26</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-28">28</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-30">30</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-32">32</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-34">34</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-36">36</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-38">38</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-40">40</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-42">42</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-44">44</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-46">46</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-48">48</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-50">50</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-52">52</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-54">54</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-56">56</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-58">58</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-60">60</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-62">62</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-64">64</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-66">66</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-68">68</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-70">70</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-72">72</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-74">74</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-76">76</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-78">78</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-80">80</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-82">82</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c3c230073566-84">84</div><div class="crayon-num" data-line="crayon-5df7170ea3c3c230073566-85">85</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TokenHandler</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-2">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-3"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">HMAC_ALGO</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"HmacSHA256"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-4"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">SEPARATOR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"."</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-5"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">SEPARATOR_SPLITTER</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"\\."</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-6">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-7"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Mac </span><span class="crayon-v">hmac</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-8">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-9"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">TokenHandler</span><span class="crayon-sy">(</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">secretKey</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-10"><span class="crayon-h">		</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-11"><span class="crayon-h">			</span><span class="crayon-v">hmac</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Mac</span><span class="crayon-sy">.</span><span class="crayon-e">getInstance</span><span class="crayon-sy">(</span><span class="crayon-v">HMAC_ALGO</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-12"><span class="crayon-h">			</span><span class="crayon-v">hmac</span><span class="crayon-sy">.</span><span class="crayon-e">init</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">SecretKeySpec</span><span class="crayon-sy">(</span><span class="crayon-v">secretKey</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">HMAC_ALGO</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-13"><span class="crayon-h">		</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">NoSuchAlgorithmException</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-i">InvalidKeyException</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-14"><span class="crayon-h">			</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">IllegalStateException</span><span class="crayon-sy">(</span><span class="crayon-s">"failed to initialize HMAC: "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">getMessage</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-15"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-16"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-18"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">UserFront </span><span class="crayon-e">parseUserFromToken</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-20"><span class="crayon-h">		</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">SEPARATOR_SPLITTER</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-21"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">length</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">length</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-22"><span class="crayon-h">			</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-23"><span class="crayon-h">				</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">userBytes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fromBase64</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-24"><span class="crayon-h">				</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">hash</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fromBase64</span><span class="crayon-sy">(</span><span class="crayon-v">parts</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-26"><span class="crayon-h">				</span><span class="crayon-t">boolean</span><span class="crayon-h"> </span><span class="crayon-v">validHash</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Arrays</span><span class="crayon-sy">.</span><span class="crayon-e">equals</span><span class="crayon-sy">(</span><span class="crayon-e">createHmac</span><span class="crayon-sy">(</span><span class="crayon-v">userBytes</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hash</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-27"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">validHash</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-28"><span class="crayon-h">					</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">UserFront </span><span class="crayon-v">userFront</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fromJSON</span><span class="crayon-sy">(</span><span class="crayon-v">userBytes</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-29"><span class="crayon-h">					</span><span class="crayon-c">// if (new Date().getTime() &lt; userFront.get) {</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-30"><span class="crayon-h">					 </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">userFront</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-31"><span class="crayon-h">					</span><span class="crayon-c">// }</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-32"><span class="crayon-h">				</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-33"><span class="crayon-h">			</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">IllegalArgumentException</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-34"><span class="crayon-h">				</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">printStackTrace</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-35"><span class="crayon-h">				</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-36"><span class="crayon-h">			</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-37"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-38"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-39"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-40">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-41"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">createTokenForUser</span><span class="crayon-sy">(</span><span class="crayon-e">UserFront </span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-42">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-43"><span class="crayon-h">		</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">userBytes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">toJSON</span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-44"><span class="crayon-h">		</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">hash</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">createHmac</span><span class="crayon-sy">(</span><span class="crayon-v">userBytes</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-45"><span class="crayon-h">		</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">StringBuilder </span><span class="crayon-v">sb</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">StringBuilder</span><span class="crayon-sy">(</span><span class="crayon-cn">170</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-46"><span class="crayon-h">		</span><span class="crayon-v">sb</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">toBase64</span><span class="crayon-sy">(</span><span class="crayon-v">userBytes</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-47"><span class="crayon-h">		</span><span class="crayon-v">sb</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">SEPARATOR</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-48"><span class="crayon-h">		</span><span class="crayon-v">sb</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">toBase64</span><span class="crayon-sy">(</span><span class="crayon-v">hash</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-49"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">sb</span><span class="crayon-sy">.</span><span class="crayon-e">toString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-50"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-51">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-52"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">UserFront </span><span class="crayon-e">fromJSON</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">userBytes</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-53">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-54"><span class="crayon-h">		</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-55"><span class="crayon-h">			</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ObjectMapper</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">readValue</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ByteArrayInputStream</span><span class="crayon-sy">(</span><span class="crayon-v">userBytes</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">UserFront</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-56"><span class="crayon-h">		</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">IOException</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-57"><span class="crayon-h">			</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">IllegalStateException</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-58"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-59"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-60">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-61"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-e">toJSON</span><span class="crayon-sy">(</span><span class="crayon-e">UserFront </span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-62">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-63"><span class="crayon-h">		</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-64"><span class="crayon-h">			</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">ObjectMapper</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">writeValueAsBytes</span><span class="crayon-sy">(</span><span class="crayon-v">user</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-65"><span class="crayon-h">		</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">JsonProcessingException</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-66"><span class="crayon-h">			</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">IllegalStateException</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-67"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-68"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-69">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-70"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">toBase64</span><span class="crayon-sy">(</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-71">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-72"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">DatatypeConverter</span><span class="crayon-sy">.</span><span class="crayon-e">printBase64Binary</span><span class="crayon-sy">(</span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-73"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-74">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-75"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-e">fromBase64</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-76">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-77"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">DatatypeConverter</span><span class="crayon-sy">.</span><span class="crayon-e">parseBase64Binary</span><span class="crayon-sy">(</span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-78"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-79">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-80"><span class="crayon-h">	</span><span class="crayon-c">// synchronized to guard internal hmac object</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-81"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">synchronized</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-e">createHmac</span><span class="crayon-sy">(</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-82">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-83"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">hmac</span><span class="crayon-sy">.</span><span class="crayon-e">doFinal</span><span class="crayon-sy">(</span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c3c230073566-84"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c3c230073566-85"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0257 seconds] -->
<p>具体使用：</p>
<p>声明一个tokenHandler，并且利用@value注入一个配置文件的密钥，然后初始化tokenhandler以后就可以使用了。</p>
<p>&nbsp;</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170ea3c4c022125056" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	/**
	 * 初始化token的处理类，解密token时用的密钥
	 * 
	 * @param secret
	 *            经过加密的密钥
	 */
	@Autowired
	public LocalLoginServiceImpl(@Value("${token.secret}") String secret) {
		// 传入的参数是密钥，不过要进行解密
		tokenHandler = new TokenHandler(DatatypeConverter.parseBase64Binary(secret));
	}

	private TokenHandler tokenHandler;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170ea3c4c022125056-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c4c022125056-2">2</div><div class="crayon-num" data-line="crayon-5df7170ea3c4c022125056-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c4c022125056-4">4</div><div class="crayon-num" data-line="crayon-5df7170ea3c4c022125056-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c4c022125056-6">6</div><div class="crayon-num" data-line="crayon-5df7170ea3c4c022125056-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c4c022125056-8">8</div><div class="crayon-num" data-line="crayon-5df7170ea3c4c022125056-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c4c022125056-10">10</div><div class="crayon-num" data-line="crayon-5df7170ea3c4c022125056-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c4c022125056-12">12</div><div class="crayon-num" data-line="crayon-5df7170ea3c4c022125056-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170ea3c4c022125056-1"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c4c022125056-2"><span class="crayon-c">	 * 初始化token的处理类，解密token时用的密钥</span></div><div class="crayon-line" id="crayon-5df7170ea3c4c022125056-3"><span class="crayon-c">	 * </span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c4c022125056-4"><span class="crayon-c">	 * @param secret</span></div><div class="crayon-line" id="crayon-5df7170ea3c4c022125056-5"><span class="crayon-c">	 *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;经过加密的密钥</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c4c022125056-6"><span class="crayon-c">	 */</span></div><div class="crayon-line" id="crayon-5df7170ea3c4c022125056-7"><span class="crayon-h">	</span><span class="crayon-n">@Autowired</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c4c022125056-8"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">LocalLoginServiceImpl</span><span class="crayon-sy">(</span><span class="crayon-n">@Value</span><span class="crayon-sy">(</span><span class="crayon-s">"${token.secret}"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">secret</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c4c022125056-9"><span class="crayon-h">		</span><span class="crayon-c">// 传入的参数是密钥，不过要进行解密</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c4c022125056-10"><span class="crayon-h">		</span><span class="crayon-v">tokenHandler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TokenHandler</span><span class="crayon-sy">(</span><span class="crayon-v">DatatypeConverter</span><span class="crayon-sy">.</span><span class="crayon-e">parseBase64Binary</span><span class="crayon-sy">(</span><span class="crayon-v">secret</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c4c022125056-11"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c4c022125056-12">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c4c022125056-13"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">TokenHandler </span><span class="crayon-v">tokenHandler</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
<p>接下来如果是密码鉴权的话就可以直接验证通过后，生成Token了</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170ea3c56247179068" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	@Override
	public String authorize(UserFront userFront, HttpServletRequest request, HttpServletResponse response) {

		// TODO 验证用户名密码
		UserFront findUserFront = baseServiceImpl.findUniqueByProperty(UserFront.class, "userMobile",
				userFront.getUserMobile());
		if (findUserFront == null) {
			throw new BusinessException("该用户不存在");
		}

		String userPwd = CommonsMethod.getHash(userFront.getUserPwd(), "MD5");
		if (!findUserFront.getUserPwd().equals(userPwd)) {
			throw new BusinessException("密码错误");
		}

		String token = tokenHandler.createTokenForUser(userFront);
		log.info("用户: " + findUserFront.getUserMobile() + "登录成功");
		return token;
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-2">2</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-4">4</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-6">6</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-8">8</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-10">10</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-12">12</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-14">14</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-16">16</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c56247179068-18">18</div><div class="crayon-num" data-line="crayon-5df7170ea3c56247179068-19">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170ea3c56247179068-1"><span class="crayon-h">	</span><span class="crayon-n">@Override</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-2"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">authorize</span><span class="crayon-sy">(</span><span class="crayon-e">UserFront </span><span class="crayon-v">userFront</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">HttpServletRequest </span><span class="crayon-v">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">HttpServletResponse </span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-4"><span class="crayon-h">		</span><span class="crayon-c">// TODO 验证用户名密码</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-5"><span class="crayon-h">		</span><span class="crayon-e">UserFront </span><span class="crayon-v">findUserFront</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">baseServiceImpl</span><span class="crayon-sy">.</span><span class="crayon-e">findUniqueByProperty</span><span class="crayon-sy">(</span><span class="crayon-v">UserFront</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"userMobile"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-6"><span class="crayon-h">				</span><span class="crayon-v">userFront</span><span class="crayon-sy">.</span><span class="crayon-e">getUserMobile</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-7"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">findUserFront</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-8"><span class="crayon-h">			</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">BusinessException</span><span class="crayon-sy">(</span><span class="crayon-s">"该用户不存在"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-9"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-10">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-11"><span class="crayon-h">		</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">userPwd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">CommonsMethod</span><span class="crayon-sy">.</span><span class="crayon-e">getHash</span><span class="crayon-sy">(</span><span class="crayon-v">userFront</span><span class="crayon-sy">.</span><span class="crayon-e">getUserPwd</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"MD5"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-12"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">findUserFront</span><span class="crayon-sy">.</span><span class="crayon-e">getUserPwd</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">equals</span><span class="crayon-sy">(</span><span class="crayon-v">userPwd</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-13"><span class="crayon-h">			</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">BusinessException</span><span class="crayon-sy">(</span><span class="crayon-s">"密码错误"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-14"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-16"><span class="crayon-h">		</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenHandler</span><span class="crayon-sy">.</span><span class="crayon-e">createTokenForUser</span><span class="crayon-sy">(</span><span class="crayon-v">userFront</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-17"><span class="crayon-h">		</span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-s">"用户: "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">findUserFront</span><span class="crayon-sy">.</span><span class="crayon-e">getUserMobile</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"登录成功"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c56247179068-18"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c56247179068-19"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0068 seconds] -->
<p>如果是第三方Oauth登录授权，就需要根据user的id查询一遍数据库，并且生成Token.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170ea3c5c425425590" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
	// 当数据库存在该微信用户的时候,通过该方法,选择性更新数据库信息,并返回token
	public String retriveTokenExist(UserOauth userOauth, Map&lt;String, Object&gt; map) {
		if (CommonsMethod.compareTwoTime(userOauth.getOauthExpires())) {
			// 已经过期或者是正好过期,更新
			userOauth.setOauthAccessToken(map.get("access_token").toString());
			userOauth.setOauthExpires(CommonsMethod.getExpiresDate((int) map.get("expires_in")));
			update(userOauth);
		}
		UserFront uFront = userOauth.getUserFront();
		String token = tokenHandler.createTokenForUser(uFront);
		log.info("微信用户:" + uFront.getUserName() + "userId:" + uFront.getUserId() + "用户再次登录成功");
		return token;
	}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170ea3c5c425425590-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c5c425425590-2">2</div><div class="crayon-num" data-line="crayon-5df7170ea3c5c425425590-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c5c425425590-4">4</div><div class="crayon-num" data-line="crayon-5df7170ea3c5c425425590-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c5c425425590-6">6</div><div class="crayon-num" data-line="crayon-5df7170ea3c5c425425590-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c5c425425590-8">8</div><div class="crayon-num" data-line="crayon-5df7170ea3c5c425425590-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c5c425425590-10">10</div><div class="crayon-num" data-line="crayon-5df7170ea3c5c425425590-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c5c425425590-12">12</div><div class="crayon-num" data-line="crayon-5df7170ea3c5c425425590-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170ea3c5c425425590-1"><span class="crayon-h">	</span><span class="crayon-c">// 当数据库存在该微信用户的时候,通过该方法,选择性更新数据库信息,并返回token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c5c425425590-2"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">retriveTokenExist</span><span class="crayon-sy">(</span><span class="crayon-e">UserOauth </span><span class="crayon-v">userOauth</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Map</span><span class="crayon-o">&lt;</span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Object</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">map</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c5c425425590-3"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">CommonsMethod</span><span class="crayon-sy">.</span><span class="crayon-e">compareTwoTime</span><span class="crayon-sy">(</span><span class="crayon-v">userOauth</span><span class="crayon-sy">.</span><span class="crayon-e">getOauthExpires</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c5c425425590-4"><span class="crayon-h">			</span><span class="crayon-c">// 已经过期或者是正好过期,更新</span></div><div class="crayon-line" id="crayon-5df7170ea3c5c425425590-5"><span class="crayon-h">			</span><span class="crayon-v">userOauth</span><span class="crayon-sy">.</span><span class="crayon-e">setOauthAccessToken</span><span class="crayon-sy">(</span><span class="crayon-v">map</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"access_token"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c5c425425590-6"><span class="crayon-h">			</span><span class="crayon-v">userOauth</span><span class="crayon-sy">.</span><span class="crayon-e">setOauthExpires</span><span class="crayon-sy">(</span><span class="crayon-v">CommonsMethod</span><span class="crayon-sy">.</span><span class="crayon-e">getExpiresDate</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">map</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-s">"expires_in"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c5c425425590-7"><span class="crayon-h">			</span><span class="crayon-e">update</span><span class="crayon-sy">(</span><span class="crayon-v">userOauth</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c5c425425590-8"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c5c425425590-9"><span class="crayon-h">		</span><span class="crayon-e">UserFront </span><span class="crayon-v">uFront</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">userOauth</span><span class="crayon-sy">.</span><span class="crayon-e">getUserFront</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c5c425425590-10"><span class="crayon-h">		</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenHandler</span><span class="crayon-sy">.</span><span class="crayon-e">createTokenForUser</span><span class="crayon-sy">(</span><span class="crayon-v">uFront</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c5c425425590-11"><span class="crayon-h">		</span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">info</span><span class="crayon-sy">(</span><span class="crayon-s">"微信用户:"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">uFront</span><span class="crayon-sy">.</span><span class="crayon-e">getUserName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"userId:"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">uFront</span><span class="crayon-sy">.</span><span class="crayon-e">getUserId</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"用户再次登录成功"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c5c425425590-12"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c5c425425590-13"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0046 seconds] -->
<p>然后加入拦截器</p>
<p>&nbsp;</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5df7170ea3c63466151573" class="crayon-syntax crayon-theme-tomorrow-night crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
/**
 * @author Skeet.WU
 * @version &lt;br&gt;
 *          &lt;p&gt;
 *          权限拦截器
 *          &lt;/p&gt;
 */

@Component("userFrontAuthInterceptor")
public class UserFrontAuthInterceptor extends HandlerInterceptorAdapter {

	/*
	 * 利用正则映射到需要拦截的路径
	 * 
	 * private String mappingURL;
	 * 
	 * public void setMappingURL(String mappingURL) { this.mappingURL = mappingURL; }
	 */
	/**
	 * 在业务处理器处理请求之前被调用 如果返回false 从当前的拦截器往回执行所有拦截器的afterCompletion(),再退出拦截器链 如果返回true 执行下一个拦截器,直到所有的拦截器都执行完毕 再执行被拦截的Controller 然后进入拦截器链, 从最后一个拦截器往回执行所有的postHandle() 接着再从最后一个拦截器往回执行所有的afterCompletion()
	 */
	@Override
	public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

		// 如果是开发机，直接一波带走，省去反复的登录
		if (serverType.isDevServer()) {
			return true;
		}

		// TODO 放过不需要权限的资源访问
		String url = request.getServletPath();
		if (NoNeedBlockURL.getAllURL().contains(url)) {
			// 如果访问的URL不许拦截，直接放过。
			return true;
		}

		String token = request.getHeader("iuu-token");

		if (token == null) {
			// TODO 例外 非登录状态也可以访问的页面

			ResponseHttpStatusChanger.unauthoried(response);
			return false;

		}

		UserFront userFront = tokenHandler.parseUserFromToken(token);
		if (userFront == null) {
			ResponseHttpStatusChanger.unauthoried(response);
			return false;
		}

		// TODO 检测访问的资源是不是在可允许的范围内
		ResponseHttpStatusChanger.ok(response, "登录成功");
		return true;

	}

	/**
	 * 初始化token的处理类，解密token时用的密钥
	 * 
	 * @param secret
	 *            经过加密的密钥
	 */
	@Autowired
	public UserFrontAuthInterceptor(@Value("${token.secret}") String secret) {
		// 传入的参数是密钥，不过要进行解密
		tokenHandler = new TokenHandler(DatatypeConverter.parseBase64Binary(secret));
	}

	private TokenHandler tokenHandler;
	@Resource
	private ServerType serverType;
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-2">2</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-4">4</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-6">6</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-8">8</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-10">10</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-12">12</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-14">14</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-16">16</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-18">18</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-20">20</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-22">22</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-24">24</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-26">26</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-28">28</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-30">30</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-32">32</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-34">34</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-36">36</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-38">38</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-40">40</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-42">42</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-44">44</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-46">46</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-48">48</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-50">50</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-52">52</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-54">54</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-56">56</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-58">58</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-60">60</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-62">62</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-64">64</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-66">66</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-68">68</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-70">70</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-72">72</div><div class="crayon-num" data-line="crayon-5df7170ea3c63466151573-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5df7170ea3c63466151573-74">74</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5df7170ea3c63466151573-1"><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-2"><span class="crayon-c"> * @author Skeet.WU</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-3"><span class="crayon-c"> * @version &lt;br&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-4"><span class="crayon-c"> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-5"><span class="crayon-c"> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;权限拦截器</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-6"><span class="crayon-c"> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-7"><span class="crayon-c"> */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-8">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-9"><span class="crayon-sy">@</span><span class="crayon-e">Component</span><span class="crayon-sy">(</span><span class="crayon-s">"userFrontAuthInterceptor"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-10"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">UserFrontAuthInterceptor</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">HandlerInterceptorAdapter</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-12"><span class="crayon-h">	</span><span class="crayon-c">/*</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-13"><span class="crayon-c">	 * 利用正则映射到需要拦截的路径</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-14"><span class="crayon-c">	 * </span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-15"><span class="crayon-c">	 * private String mappingURL;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-16"><span class="crayon-c">	 * </span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-17"><span class="crayon-c">	 * public void setMappingURL(String mappingURL) { this.mappingURL = mappingURL; }</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-18"><span class="crayon-c">	 */</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-19"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-20"><span class="crayon-c">	 * 在业务处理器处理请求之前被调用 如果返回false 从当前的拦截器往回执行所有拦截器的afterCompletion(),再退出拦截器链 如果返回true 执行下一个拦截器,直到所有的拦截器都执行完毕 再执行被拦截的Controller 然后进入拦截器链, 从最后一个拦截器往回执行所有的postHandle() 接着再从最后一个拦截器往回执行所有的afterCompletion()</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-21"><span class="crayon-c">	 */</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-22"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-23"><span class="crayon-e">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">boolean</span><span class="crayon-h"> </span><span class="crayon-e">preHandle</span><span class="crayon-sy">(</span><span class="crayon-e">HttpServletRequest </span><span class="crayon-v">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">HttpServletResponse </span><span class="crayon-v">response</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">Object</span><span class="crayon-h"> </span><span class="crayon-v">handler</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-24">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-25"><span class="crayon-h">		</span><span class="crayon-c">// 如果是开发机，直接一波带走，省去反复的登录</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-26"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">serverType</span><span class="crayon-sy">.</span><span class="crayon-e">isDevServer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-27"><span class="crayon-h">			</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-28"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-30"><span class="crayon-h">		</span><span class="crayon-c">// TODO 放过不需要权限的资源访问</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-31"><span class="crayon-h">		</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-e">getServletPath</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-32"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">NoNeedBlockURL</span><span class="crayon-sy">.</span><span class="crayon-e">getAllURL</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">contains</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-33"><span class="crayon-h">			</span><span class="crayon-c">// 如果访问的URL不许拦截，直接放过。</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-34"><span class="crayon-h">			</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-35"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-36">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-37"><span class="crayon-h">		</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-e">getHeader</span><span class="crayon-sy">(</span><span class="crayon-s">"iuu-token"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-38">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-39"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-40"><span class="crayon-h">			</span><span class="crayon-c">// TODO 例外 非登录状态也可以访问的页面</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-42"><span class="crayon-h">			</span><span class="crayon-v">ResponseHttpStatusChanger</span><span class="crayon-sy">.</span><span class="crayon-e">unauthoried</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-43"><span class="crayon-h">			</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-44">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-45"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-46">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-47"><span class="crayon-h">		</span><span class="crayon-e">UserFront </span><span class="crayon-v">userFront</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tokenHandler</span><span class="crayon-sy">.</span><span class="crayon-e">parseUserFromToken</span><span class="crayon-sy">(</span><span class="crayon-v">token</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-48"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">userFront</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-49"><span class="crayon-h">			</span><span class="crayon-v">ResponseHttpStatusChanger</span><span class="crayon-sy">.</span><span class="crayon-e">unauthoried</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-50"><span class="crayon-h">			</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-51"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-52">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-53"><span class="crayon-h">		</span><span class="crayon-c">// TODO 检测访问的资源是不是在可允许的范围内</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-54"><span class="crayon-h">		</span><span class="crayon-v">ResponseHttpStatusChanger</span><span class="crayon-sy">.</span><span class="crayon-e">ok</span><span class="crayon-sy">(</span><span class="crayon-v">response</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"登录成功"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-55"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-56">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-57"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-58">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-59"><span class="crayon-h">	</span><span class="crayon-c">/**</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-60"><span class="crayon-c">	 * 初始化token的处理类，解密token时用的密钥</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-61"><span class="crayon-c">	 * </span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-62"><span class="crayon-c">	 * @param secret</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-63"><span class="crayon-c">	 *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;经过加密的密钥</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-64"><span class="crayon-c">	 */</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-65"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Autowired</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-66"><span class="crayon-e">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">UserFrontAuthInterceptor</span><span class="crayon-sy">(</span><span class="crayon-sy">@</span><span class="crayon-e">Value</span><span class="crayon-sy">(</span><span class="crayon-s">"${token.secret}"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">secret</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-67"><span class="crayon-h">		</span><span class="crayon-c">// 传入的参数是密钥，不过要进行解密</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-68"><span class="crayon-h">		</span><span class="crayon-v">tokenHandler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TokenHandler</span><span class="crayon-sy">(</span><span class="crayon-v">DatatypeConverter</span><span class="crayon-sy">.</span><span class="crayon-e">parseBase64Binary</span><span class="crayon-sy">(</span><span class="crayon-v">secret</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-69"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-70">&nbsp;</div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-71"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">TokenHandler </span><span class="crayon-v">tokenHandler</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-72"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Resource</span></div><div class="crayon-line" id="crayon-5df7170ea3c63466151573-73"><span class="crayon-e">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">ServerType </span><span class="crayon-v">serverType</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df7170ea3c63466151573-74"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0093 seconds] -->
<p>妥妥的了！</p>
<p>&nbsp;</p>
<p>有一个小问题，待结果，User对象中的password一定要ignore掉。</p>
<p>第二个小问题，token的长度可能需要通过控制user中field的个数来限制一下。//TODO</p>
    </div>
  </div>
</article>
    
          <nav class="post-nav">
        <ul class="pager">
          <li class="previous"><a href="http://www.tiaobug.com/page/7" >&larr; Older posts</a></li>
          <li class="next"><a href="http://www.tiaobug.com/page/5" >Newer posts &rarr;</a></li>
        </ul>
      </nav>
      </div>      </main>
    </div>
  </div>
  <div class="bottom-info">
<div style="font-size: 12px;text-align: center;padding:28px 0 0 0">@娱乐性质的个人Blog，技术文章居多，偶发性会有深思文，请谨慎关注，随意转发，如果可以请把出处写上
</div>
<div style="font-size: 10px;text-align: center;padding:5px 0 0 0">联系我，个人微博，Twitter，FaceBook等等各种账号，请@tiaobug，Email: i@tiaobug.com
</div>
<div style="font-size: 12px;text-align: center;padding:5px 0 12px 0 ">鲁ICP备17013530号
</div>
</div><script type='text/javascript' src='http://www.tiaobug.com/wp-content/themes/dw-timeline/assets/js/vendor/jquery.infinitescroll.min.js?ver=4.8.12'></script>
<script type='text/javascript' src='http://www.tiaobug.com/wp-content/themes/dw-timeline/assets/js/vendor/bootstrap-3.0.3.min.js?ver=4.8.12'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var dwtl = {"template_directory_uri":"http:\/\/www.tiaobug.com\/wp-content\/themes\/dw-timeline"};
var infinitescroll = {"page":"page","the_end":"the end"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.tiaobug.com/wp-content/themes/dw-timeline/assets/js/scripts.js?ver=4.8.12'></script>
<script type='text/javascript' src='http://www.tiaobug.com/wp-includes/js/wp-embed.min.js?ver=4.8.12'></script>

</body>
</html>
